<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Personal Assistant</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #444;
        }
        .dark-mode {
            background-color: #333;
            color: #f9f9f9;
        }
        .dark-mode .container {
            background-color: #444;
            color: #f9f9f9;
        }
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: #444;
        }
        .dark-mode .dark-mode-toggle {
            color: #f9f9f9;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
            background-color: #f1f1f1;
        }
        .message.user-message {
            background-color: #e3f2fd;
        }
        .message.bot-message {
            background-color: #fff3e0;
        }
        .message.chat-message {
            background-color: #f9f9f9;
            border-left: 4px solid #007bff;
        }
        .message strong {
            color: #007bff;
        }
        .message em {
            color: #666;
            font-size: 0.9em;
        }
        .icon-preview img {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .section h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Personal Assistant</h1>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i>
        </button>

        <!-- Conversation Section -->
        <div class="section">
            <h2>Conversation</h2>
            <div id="conversation"></div>
            <div class="form-group">
                <label for="user-input">Enter your message:</label>
                <textarea id="user-input" placeholder="Type your message here..."></textarea>
            </div>
            <button id="send-button">Send</button>
            <button id="clear-button">Clear Conversation</button>
        </div>

        <!-- Task Automation Section -->
        <div class="section">
            <h2>Task Automation</h2>
            <div id="task-list"></div>
            <button id="add-task-button">Add Task</button>
            <button id="start-tasks-button">Start Tasks</button>
            <button id="stop-tasks-button">Stop Tasks</button>
            <button id="pause-tasks-button">Pause Tasks</button>
            <button id="resume-tasks-button">Resume Tasks</button>
        </div>

        <!-- Notification Interval Section -->
        <div class="section">
            <h2>Notification Interval</h2>
            <div class="form-group">
                <label for="interval-input">Check for new messages every (seconds):</label>
                <input type="number" id="interval-input" min="1" value="10">
            </div>
            <button id="set-interval-button">Set Interval</button>
        </div>

        <!-- Area of Interest Section -->
        <div class="section">
            <h2>Area of Interest</h2>
            <div class="form-group">
                <label for="x1">Top-left X:</label>
                <input type="number" id="x1" min="0" value="0">
                <label for="y1">Top-left Y:</label>
                <input type="number" id="y1" min="0" value="0">
                <label for="x2">Bottom-right X:</label>
                <input type="number" id="x2" min="0" value="100">
                <label for="y2">Bottom-right Y:</label>
                <input type="number" id="y2" min="0" value="100">
            </div>
            <button id="set-area-button">Set Area of Interest</button>
        </div>

        <!-- Message Icon Section -->
        <div class="section">
            <h2>Message Icon</h2>
            <div class="form-group">
                <label for="icon-path">Icon Path:</label>
                <input type="text" id="icon-path" placeholder="Enter icon file path">
                <label for="icon-size">Icon Size:</label>
                <input type="number" id="icon-size" min="16" value="32">
            </div>
            <button id="set-icon-button">Set Message Icon</button>
            <div id="icon-preview" class="icon-preview"></div>
        </div>

        <!-- Voice Customization Section -->
        <div class="section">
            <h2>Voice Customization</h2>
            <div class="form-group">
                <label for="pitch">Pitch:</label>
                <input type="range" id="pitch" min="-50%" max="50%" value="0%" step="10%">
                <span id="pitch-value">0%</span>
                <label for="rate">Rate:</label>
                <input type="range" id="rate" min="0.5" max="2.0" value="1.0" step="0.1">
                <span id="rate-value">1.0</span>
            </div>
            <button id="preview-voice-button">Preview Voice</button>
        </div>

        <!-- Tone Adjustment Section -->
        <div class="section">
            <h2>Tone Adjustment</h2>
            <div class="form-group">
                <label for="tone">Select tone:</label>
                <select id="tone">
                    <option value="professional">Professional</option>
                    <option value="friendly">Friendly</option>
                    <option value="casual">Casual</option>
                </select>
            </div>
            <button id="adjust-tone-button">Adjust Tone</button>
            <div id="tone-adjusted-message"></div>
        </div>

        <!-- Voice Selection Section -->
        <div class="section">
            <h2>Voice Selection</h2>
            <div class="form-group">
                <label for="voice">Select voice:</label>
                <select id="voice">
                    <option value="zu-ZA-ThandoNeural">Zulu - Thando</option>
                    <option value="af-ZA-AdriNeural">Afrikaans - Adri</option>
                    <option value="en-GB-RyanNeural">British English - Ryan</option>
                    <option value="en-US-JennyNeural">US English - Jenny</option>
                    <option value="en-AU-NatashaNeural">Australian English - Natasha</option>
                </select>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="section">
            <h2>Analysis</h2>
            <button id="analyze-button">Analyze Conversation</button>
            <div id="recommendations"></div>
        </div>

        <!-- Conversation Analysis Section -->
        <div class="section">
            <h2>Conversation Analysis</h2>
            <div class="form-group">
                <label for="analysis-input">Paste email or conversation:</label>
                <textarea id="analysis-input" rows="8" placeholder="Paste your conversation here..."></textarea>
            </div>
            <button id="analyze-conversation-button">Analyze</button>
            <div id="conversation-analysis-result"></div>
        </div>

        <!-- OCR Section -->
        <div class="section">
            <h2>Extract Text from Image</h2>
            <div class="form-group">
                <input type="file" id="image-upload" accept="image/*">
            </div>
            <button id="extract-text-button">Extract Text</button>
            <div id="extracted-text"></div>
        </div>

        <!-- Chat Section -->
        <div class="section">
            <h2>Chat with Others</h2>
            <div id="chat-box"></div>
            <div class="form-group">
                <input type="text" id="username" placeholder="Your name">
                <textarea id="chat-input" placeholder="Type your chat message here..."></textarea>
            </div>
            <button id="send-chat-button">Send</button>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            let conversationHistory = [];
            let chatMessages = [];

            // Dark mode toggle
            function toggleDarkMode() {
                $('body').toggleClass('dark-mode');
                const isDarkMode = $('body').hasClass('dark-mode');
                localStorage.setItem('darkMode', isDarkMode);
                $('.dark-mode-toggle i').toggleClass('fa-moon fa-sun');
            }

            if (localStorage.getItem('darkMode') === 'true') {
                toggleDarkMode();
            }

            // Task Automation Functions
            function fetchTasks() {
                $.ajax({
                    type: 'GET',
                    url: '/get_tasks',
                    success: function(data) {
                        $('#task-list').html(data.tasks.map((task, index) => `
                            <div class="task">
                                <strong>Task ${index + 1}:</strong> ${task.type} - ${JSON.stringify(task)}
                                <button onclick="removeTask(${index})">Remove</button>
                            </div>
                        `).join(''));
                    },
                    error: function() {
                        alert('Failed to fetch tasks. Please try again.');
                    }
                });
            }

            window.removeTask = function(index) {
                $.ajax({
                    type: 'POST',
                    url: '/remove_task',
                    contentType: 'application/json',
                    data: JSON.stringify({ index: index }),
                    success: function() {
                        fetchTasks();
                    },
                    error: function() {
                        alert('Failed to remove task. Please try again.');
                    }
                });
            }

            $('#add-task-button').click(function() {
                const taskType = prompt("Enter task type (click/hotkey/move):");
                if (!taskType) return;

                let taskData = {};
                if (taskType === "click") {
                    const x = prompt("Enter X coordinate:");
                    const y = prompt("Enter Y coordinate:");
                    const delay = prompt("Enter delay (seconds):");
                    taskData = { type: "click", x: parseInt(x), y: parseInt(y), delay: parseFloat(delay) };
                } else if (taskType === "hotkey") {
                    const hotkey = prompt("Enter hotkey (e.g., ctrl+c):");
                    const delay = prompt("Enter delay (seconds):");
                    taskData = { type: "hotkey", hotkey: hotkey, delay: parseFloat(delay) };
                } else if (taskType === "move") {
                    const startX = prompt("Enter start X coordinate:");
                    const startY = prompt("Enter start Y coordinate:");
                    const endX = prompt("Enter end X coordinate:");
                    const endY = prompt("Enter end Y coordinate:");
                    const delay = prompt("Enter delay (seconds):");
                    taskData = { type: "move", startX: parseInt(startX), startY: parseInt(startY), endX: parseInt(endX), endY: parseInt(endY), delay: parseFloat(delay) };
                }

                $.ajax({
                    type: 'POST',
                    url: '/add_task',
                    contentType: 'application/json',
                    data: JSON.stringify(taskData),
                    success: function() {
                        fetchTasks();
                    },
                    error: function() {
                        alert('Failed to add task. Please try again.');
                    }
                });
            });

            $('#start-tasks-button').click(function() {
                $.ajax({
                    type: 'POST',
                    url: '/start_tasks',
                    success: function() {
                        alert('Tasks started.');
                    },
                    error: function() {
                        alert('Failed to start tasks. Please try again.');
                    }
                });
            });

            $('#stop-tasks-button').click(function() {
                $.ajax({
                    type: 'POST',
                    url: '/stop_tasks',
                    success: function() {
                        alert('Tasks stopped.');
                    },
                    error: function() {
                        alert('Failed to stop tasks. Please try again.');
                    }
                });
            });

            $('#pause-tasks-button').click(function() {
                $.ajax({
                    type: 'POST',
                    url: '/pause_tasks',
                    success: function() {
                        alert('Tasks paused.');
                    },
                    error: function() {
                        alert('Failed to pause tasks. Please try again.');
                    }
                });
            });

            $('#resume-tasks-button').click(function() {
                $.ajax({
                    type: 'POST',
                    url: '/resume_tasks',
                    success: function() {
                        alert('Tasks resumed.');
                    },
                    error: function() {
                        alert('Failed to resume tasks. Please try again.');
                    }
                });
            });

            // Set Notification Interval
            $('#set-interval-button').click(function() {
                const interval = $('#interval-input').val();
                if (!interval || interval < 1) {
                    alert('Please enter a valid interval (minimum 1 second).');
                    return;
                }

                $.ajax({
                    type: 'POST',
                    url: '/set_notification_interval',
                    contentType: 'application/json',
                    data: JSON.stringify({ interval: parseInt(interval) }),
                    success: function() {
                        alert('Notification interval updated.');
                    },
                    error: function() {
                        alert('Failed to set notification interval. Please try again.');
                    }
                });
            });

            // Set Area of Interest
            $('#set-area-button').click(function() {
                const x1 = $('#x1').val();
                const y1 = $('#y1').val();
                const x2 = $('#x2').val();
                const y2 = $('#y2').val();

                if (!x1 || !y1 || !x2 || !y2) {
                    alert('Please enter all coordinates.');
                    return;
                }

                const area = { x1: parseInt(x1), y1: parseInt(y1), x2: parseInt(x2), y2: parseInt(y2) };
                $.ajax({
                    type: 'POST',
                    url: '/set_area_of_interest',
                    contentType: 'application/json',
                    data: JSON.stringify(area),
                    success: function() {
                        alert('Area of interest updated.');
                    },
                    error: function() {
                        alert('Failed to set area of interest. Please try again.');
                    }
                });
            });

            // Set Message Icon
            $('#set-icon-button').click(function() {
                const iconPath = $('#icon-path').val();
                const iconSize = $('#icon-size').val();

                if (!iconPath || !iconSize) {
                    alert('Please enter both icon path and size.');
                    return;
                }

                const iconSettings = { icon_path: iconPath, icon_size: parseInt(iconSize) };
                $.ajax({
                    type: 'POST',
                    url: '/set_message_icon',
                    contentType: 'application/json',
                    data: JSON.stringify(iconSettings),
                    success: function() {
                        alert('Message icon updated.');
                        $('#icon-preview').html(`<img src="${iconPath}" alt="Message Icon" style="width: ${iconSize}px; height: ${iconSize}px;">`);
                    },
                    error: function() {
                        alert('Failed to set message icon. Please try again.');
                    }
                });
            });

            // Initial fetch of tasks
            fetchTasks();

            $('#send-button').click(function() {
                const userInput = $('#user-input').val().trim();
                if (!userInput) return;
                $('#send-button').html('Sending... <div class="loading"></div>');
                $.ajax({
                    type: 'POST',
                    url: '/generate',
                    contentType: 'application/json',
                    data: JSON.stringify({ input: userInput }),
                    success: function(data) {
                        conversationHistory.push({ type: "User", text: userInput });
                        conversationHistory.push({ type: "Bot", text: data.response });
                        updateConversationDisplay();
                        $('#user-input').val('');
                        $('#send-button').html('Send');
                    },
                    error: function() {
                        alert('Failed to send message. Please try again.');
                        $('#send-button').html('Send');
                    }
                });
            });

            $('#clear-button').click(function() {
                conversationHistory = [];
                updateConversationDisplay();
            });

            $('#preview-voice-button').click(function() {
                const previewText = "This is a preview of the current voice settings.";
                const selectedVoiceName = $('#voice').val();
                const pitch = $('#pitch').val() + "%";
                const rate = $('#rate').val();
                $.ajax({
                    type: 'POST',
                    url: '/synthesize',
                    contentType: 'application/json',
                    data: JSON.stringify({ text: previewText, voice_name: selectedVoiceName, pitch: pitch, rate: rate }),
                    success: function(data) {
                        new Audio('/audio/' + data.audio_file).play().catch(() => alert('Failed to play audio.'));
                    },
                    error: function() {
                        alert('Speech synthesis failed. Please try again.');
                    }
                });
            });

            $('#adjust-tone-button').click(function() {
                const message = $('#user-input').val().trim();
                const tone = $('#tone').val();
                if (!message) return;
                $('#adjust-tone-button').html('Adjusting... <div class="loading"></div>');
                $.ajax({
                    type: 'POST',
                    url: '/tone',
                    contentType: 'application/json',
                    data: JSON.stringify({ message: message, tone: tone }),
                    success: function(data) {
                        $('#tone-adjusted-message').html(`<strong>Adjusted Message:</strong> ${data.adjusted_message}`);
                        $('#adjust-tone-button').html('Adjust Tone');
                    },
                    error: function() {
                        alert('Failed to adjust tone. Please try again.');
                        $('#adjust-tone-button').html('Adjust Tone');
                    }
                });
            });

            $('#analyze-button').click(function() {
                const conversationText = conversationHistory.map(item => `${item.type}: ${item.text}`).join('\n');
                if (!conversationText) return;
                $('#analyze-button').html('Analyzing... <div class="loading"></div>');
                $.ajax({
                    type: 'POST',
                    url: '/analyze',
                    contentType: 'application/json',
                    data: JSON.stringify({ conversation: conversationText }),
                    success: function(data) {
                        $('#recommendations').html(`<strong>Recommendations:</strong><br>${data.recommendations.replace(/\n/g, '<br>')}`);
                        $('#analyze-button').html('Analyze Conversation');
                    },
                    error: function() {
                        alert('Failed to analyze conversation. Please try again.');
                        $('#analyze-button').html('Analyze Conversation');
                    }
                });
            });

            $('#analyze-conversation-button').click(function() {
                const conversationText = $('#analysis-input').val().trim();
                if (!conversationText) return;
                $('#analyze-conversation-button').html('Analyzing... <div class="loading"></div>');
                $.ajax({
                    type: 'POST',
                    url: '/analyze_conversation',
                    contentType: 'application/json',
                    data: JSON.stringify({ conversation_text: conversationText }),
                    success: function(data) {
                        $('#conversation-analysis-result').html(`<strong>Analysis:</strong><br>${data.analysis}`);
                        $('#analyze-conversation-button').html('Analyze');
                    },
                    error: function() {
                        alert('Failed to analyze conversation. Please try again.');
                        $('#analyze-conversation-button').html('Analyze');
                    }
                });
            });

            $('#extract-text-button').click(function() {
                const fileInput = $('#image-upload')[0];
                if (!fileInput.files.length) {
                    alert('Please select an image file.');
                    return;
                }
                const formData = new FormData();
                formData.append('image', fileInput.files[0]);
                $('#extract-text-button').html('Extracting... <div class="loading"></div>');
                $.ajax({
                    type: 'POST',
                    url: '/extract_text',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function(data) {
                        $('#extracted-text').html(`<strong>Extracted Text:</strong><br>${data.extracted_text.replace(/\n/g, '<br>')}`);
                        $('#extract-text-button').html('Extract Text');
                    },
                    error: function() {
                        alert('Failed to extract text. Please try again.');
                        $('#extract-text-button').html('Extract Text');
                    }
                });
            });

            $('#send-chat-button').click(function() {
                const username = $('#username').val().trim() || 'Anonymous';
                const message = $('#chat-input').val().trim();
                if (!message) return;
                $('#send-chat-button').html('Sending... <div class="loading"></div>');
                $.ajax({
                    type: 'POST',
                    url: '/send_message',
                    contentType: 'application/json',
                    data: JSON.stringify({ username: username, message: message }),
                    success: function(data) {
                        if (data.status === 'Message sent successfully') {
                            $('#chat-input').val('');
                            fetchChatMessages();
                        }
                        $('#send-chat-button').html('Send');
                    },
                    error: function() {
                        alert('Failed to send message. Please try again.');
                        $('#send-chat-button').html('Send');
                    }
                });
            });

            function fetchChatMessages() {
                $.ajax({
                    type: 'GET',
                    url: '/get_messages',
                    success: function(data) {
                        chatMessages = data.messages;
                        updateChatDisplay();
                    },
                    error: function() {
                        alert('Failed to fetch chat messages. Please try again.');
                    }
                });
            }

            function updateConversationDisplay() {
                $('#conversation').html(conversationHistory.map((item, index) => `
                    <div class="message ${item.type === "User" ? "user-message" : "bot-message"}">
                        ${item.text}
                        <button onclick="playTextToSpeech(${index})">Listen</button>
                        <button onclick="copyToClipboard('${item.text}')">Copy to Clipboard</button>
                    </div>
                `).join('')).scrollTop($('#conversation')[0].scrollHeight);
            }

            function updateChatDisplay() {
                $('#chat-box').html(chatMessages.map(msg => `
                    <div class="message chat-message">
                        <strong>${msg.username}:</strong> ${msg.message} <em>(${msg.timestamp})</em>
                    </div>
                `).join('')).scrollTop($('#chat-box')[0].scrollHeight);
            }

            window.copyToClipboard = function(text) {
                navigator.clipboard.writeText(text).then(() => alert('Text copied to clipboard')).catch(() => alert('Failed to copy text to clipboard. Please try again.'));
            }

            window.playTextToSpeech = function(index) {
                const text = conversationHistory[index].text;
                const selectedVoiceName = $('#voice').val();
                const pitch = $('#pitch').val() + "%";
                const rate = $('#rate').val();
                $.ajax({
                    type: 'POST',
                    url: '/synthesize',
                    contentType: 'application/json',
                    data: JSON.stringify({ text: text, voice_name: selectedVoiceName, pitch: pitch, rate: rate }),
                    success: function(data) {
                        new Audio('/audio/' + data.audio_file).play().catch(() => alert('Failed to play audio.'));
                    },
                    error: function() {
                        alert('Speech synthesis failed. Please try again.');
                    }
                });
            }

            // Fetch chat messages every 2 seconds
            setInterval(fetchChatMessages, 2000);

            // Initial fetch
            fetchChatMessages();
        });
    </script>
</body>
</html>